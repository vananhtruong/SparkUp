@{
    ViewData["Title"] = "Worker Register";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h2 class="text-center mb-4">Đăng Ký Làm Thợ</h2>
                    <p class="text-muted text-center mb-4">Vui lòng điền thông tin và tải lên chứng chỉ của bạn</p>

                    <form asp-action="WorkerRegister" asp-controller="Authentication" method="post" enctype="multipart/form-data">
                        <div class="mb-4">
                            <label class="form-label">Loại Dịch Vụ</label>
                            <select class="form-select" name="WorkTypeId" required>
                                <option value="">Chọn loại dịch vụ</option>
                                @foreach (var taskType in ViewBag.TaskTypes)
                                {
                                    <option value="@taskType.Id">@taskType.Name</option>
                                }
                            </select>
                            <div class="form-text">Chọn một loại dịch vụ bạn muốn đăng ký</div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Chứng Chỉ Hành Nghề</label>
                            <div class="btn-group w-100 mb-3" role="group">
                                <input type="radio" class="btn-check" name="certificateType" id="uploadType" value="upload" checked>
                                <label class="btn btn-outline-primary" for="uploadType">
                                    <i class="bi bi-upload me-2"></i>Tải lên file
                                </label>
                                <input type="radio" class="btn-check" name="certificateType" id="urlType" value="url">
                                <label class="btn btn-outline-primary" for="urlType">
                                    <i class="bi bi-link-45deg me-2"></i>Nhập URL
                                </label>
                            </div>

                            <!-- File Upload Section -->
                            <div id="uploadSection">
                                <div class="input-group">
                                    <input type="file" class="form-control" name="Certificate" accept=".pdf,.jpg,.jpeg,.png">
                                    <button class="btn btn-outline-secondary" type="button" id="previewBtn">
                                        <i class="bi bi-eye"></i> Xem trước
                                    </button>
                                </div>
                                <div class="form-text">Chấp nhận file PDF, JPG, JPEG, PNG (tối đa 5MB)</div>
                            </div>

                            <!-- URL Input Section -->
                            <div id="urlSection" style="display: none;">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                                    <input type="url" class="form-control" name="CertificateUrl" placeholder="https://example.com/certificate.pdf">
                                </div>
                                <div class="form-text">Nhập URL chứng chỉ của bạn (PDF hoặc hình ảnh)</div>
                            </div>

                            <div class="mb-4" id="previewContainer" style="display: none;">
                                <div class="card">
                                    <div class="card-body p-2">
                                        <img id="previewImage" class="img-fluid" alt="Preview">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Kinh Nghiệm Làm Việc</label>
                            <textarea class="form-control" name="Experience" rows="3" placeholder="Mô tả kinh nghiệm làm việc của bạn..." required></textarea>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-send me-2"></i>Gửi Yêu Cầu
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Toggle between upload and URL sections
        document.querySelectorAll('input[name="certificateType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const uploadSection = document.getElementById('uploadSection');
                const urlSection = document.getElementById('urlSection');
                const previewContainer = document.getElementById('previewContainer');
                
                if (this.value === 'upload') {
                    uploadSection.style.display = 'block';
                    urlSection.style.display = 'none';
                    document.querySelector('input[name="Certificate"]').required = true;
                    document.querySelector('input[name="CertificateUrl"]').required = false;
                } else {
                    uploadSection.style.display = 'none';
                    urlSection.style.display = 'block';
                    document.querySelector('input[name="Certificate"]').required = false;
                    document.querySelector('input[name="CertificateUrl"]').required = true;
                    previewContainer.style.display = 'none';
                }
            });
        });

        // Preview uploaded image
        document.querySelector('input[type="file"]').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewContainer = document.getElementById('previewContainer');
                    const previewImage = document.getElementById('previewImage');
                    
                    if (file.type.startsWith('image/')) {
                        previewImage.src = e.target.result;
                        previewContainer.style.display = 'block';
                    } else {
                        previewContainer.style.display = 'none';
                    }
                }
                reader.readAsDataURL(file);
            }
        });

        // Preview button click handler
        document.getElementById('previewBtn').addEventListener('click', function() {
            const fileInput = document.querySelector('input[type="file"]');
            if (fileInput.files.length > 0) {
                const previewContainer = document.getElementById('previewContainer');
                previewContainer.style.display = previewContainer.style.display === 'none' ? 'block' : 'none';
            }
        });

        // Initialize select2 for single select
        $(document).ready(function() {
            $('select[name="WorkTypeId"]').select2({
                placeholder: "Chọn loại dịch vụ",
                allowClear: true,
                width: '100%'
            });
        });
    </script>
}

<style>
    .select2-container--default .select2-selection--single {
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        height: 38px;
        display: flex;
        align-items: center;
    }

    .select2-container--default.select2-container--focus .select2-selection--single {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 38px;
        padding-left: 12px;
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 36px;
    }

    .card {
        border: none;
        border-radius: 10px;
    }

    .form-control:focus, .form-select:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    .btn-primary {
        padding: 0.75rem 1.5rem;
    }

    #previewContainer {
        max-height: 300px;
        overflow: hidden;
    }

    #previewImage {
        max-height: 300px;
        object-fit: contain;
    }

    .btn-check:checked + .btn-outline-primary {
        background-color: #0d6efd;
        color: white;
    }

    .btn-group {
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
</style> 